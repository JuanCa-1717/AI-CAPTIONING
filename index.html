<!DOCTYPE html>
<html>
  <head>
	<script defer src="./injectScript.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="styleguide.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      /** @type {import('tailwindcss').Config} */
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              "body-base": "var(--body-base-font-family)",
              "body-small-strong": "var(--body-small-strong-font-family)",
            },
          },
        },
        plugins: [],
      };
    </script>
    <style>
      .chat-item {
        transition: all 0.3s ease;
      }
      
      .chat-item .chat-indicator {
        width: 0;
        opacity: 0;
        transition: all 0.3s ease;
      }
      
      .chat-item.active .chat-indicator {
        width: 2px;
        opacity: 1;
      }
      
      .chat-item .chat-text {
        color: #95a3a6;
        font-weight: 400;
        transition: all 0.3s ease;
      }
      
      .chat-item.active .chat-text {
        color: #ccd0cf;
        font-weight: 600;
      }
      
      .sidebar {
        transition: width 0.3s ease;
        overflow: hidden;
      }
      
      .sidebar.collapsed {
        width: 70px !important;
      }
      
      .sidebar-content {
        transition: opacity 0.3s ease;
        min-width: 318px;
      }
      
      .sidebar.collapsed .sidebar-content {
        opacity: 0;
        pointer-events: none;
      }
      
      .menu-button {
        transition: opacity 0.3s ease;
      }
    </style>
    <style>
      html, body {
        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      body {
        min-width: 0;
        min-height: 0;
      }
      .main-bg {
        width: 100vw !important;
        height: 100vh !important;
        min-width: 0 !important;
        min-height: 0 !important;
      }
    </style>
  </head>
  <body>
    <script>
      function selectChat(element) {
        // Remove active class from all chat items
        document.querySelectorAll('.chat-item').forEach(item => {
          item.classList.remove('active');
        });
        
        // Add active class to clicked item
        element.classList.add('active');
      }
      
      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('collapsed');
      }
    </script>
    <div
      class="main-bg [background:url(https://c.animaapp.com/mjmcwbk4IDVKoU/img/main.png)_50%_50%_/_cover] w-full h-full min-w-0 min-h-0 flex flex-col relative"
      id="main-bg"
    >
      <div
        class="absolute top-0 left-0 w-full h-[57px] bg-[#ffffff14] border-b-[0.1px] [border-bottom-style:solid] border-[#ffffff7d] shadow-[0px_12px_50.3px_#00000040] backdrop-blur-[9.9px] backdrop-brightness-[100%] [-webkit-backdrop-filter:blur(9.9px)_brightness(100%)]"
      ></div>
      <div class="flex flex-wrap items-center gap-2 px-2 py-px absolute top-2 right-4" id="firebase-auth-container">
        <div id="firebase-profile" style="display:none;" class="flex items-center gap-2">
          <img id="firebase-avatar" class="relative w-6 h-6 rounded-full bg-cover bg-[50%_50%]" src="" alt="Profile" />
          <span id="firebase-name" class="relative font-body-base text-[#97a5a8]"></span>
          <button onclick="firebaseLogout()" class="ml-2 auth-btn auth-btn--ghost">Sign out</button>
        </div>
        <button id="firebase-login-btn" class="auth-top-btn auth-btn auth-btn--primary">Log in</button>
        <button id="firebase-register-open-btn" class="auth-top-btn auth-btn auth-btn--secondary">Sign up</button>
      </div>

      <!-- Firebase SDKs -->
      <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth-compat.js"></script>


      <!-- Login modal (solo inicio de sesión) -->
      <div id="firebase-login-modal" class="auth-modal">
        <div class="auth-card auth-card-spaced">
          <h2 class="auth-header">Log in</h2>
          <div class="auth-fields">
            <input id="login-email" class="auth-input" type="email" placeholder="Email" />
            <input id="login-password" class="auth-input" type="password" placeholder="Password" />
          </div>
          <div class="auth-buttons">
            <button id="firebase-email-login-btn" class="auth-btn auth-btn--primary" style="width:100%">Log in</button>
            <button id="firebase-google-login-btn" class="auth-btn auth-btn--ghost" style="width:100%">Log in with Google</button>
            <button id="firebase-close-login-modal" class="auth-btn auth-close" style="width:100%">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Register modal (solo crear cuenta con email) -->
      <div id="firebase-register-modal" class="auth-modal">
        <div class="auth-card auth-card-spaced">
          <h2 class="auth-header">Sign up</h2>
          <div class="auth-fields">
            <input id="register-email" class="auth-input" type="email" placeholder="Email" />
            <input id="register-password" class="auth-input" type="password" placeholder="Password" />
          </div>
          <div class="auth-buttons">
            <button id="firebase-register-submit-btn" class="auth-btn auth-btn--secondary" style="width:100%">Create account</button>
            <button id="firebase-register-google-btn" class="auth-btn auth-btn--ghost" style="width:100%">Sign up with Google</button>
            <button id="firebase-close-register-modal" class="auth-btn auth-close" style="width:100%">Cancel</button>
          </div>
        </div>
      </div>
    <style>
      .auth-card-spaced {
        padding: 2rem 1.5rem !important;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }
      .auth-fields {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .auth-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.7rem;
      }
    </style>

      <!-- Message modal (reemplaza alert) -->
      <div id="firebase-message-modal" class="auth-modal">
        <div class="auth-card message-card">
          <div id="firebase-message-content" style="margin-bottom:1rem; color:var(--c-6)"></div>
          <button id="firebase-message-close" class="auth-btn auth-btn--primary" style="width:100%">Close</button>
        </div>
      </div>

      <script>
        const firebaseConfig = {
          apiKey: "AIzaSyCxW--usdfHZK6NJw9SiADLzwtozvSjm2w",
          authDomain: "sightforgen.firebaseapp.com",
          projectId: "sightforgen",
          storageBucket: "sightforgen.firebasestorage.app",
          messagingSenderId: "337444110932",
          appId: "1:337444110932:web:16fe01dc63902d7e39e3c1",
          measurementId: "G-VYFQ1DVGDY"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        function updateFirebaseUI(user) {
            if (user) {
              document.getElementById('firebase-profile').style.display = 'flex';
              document.getElementById('firebase-avatar').src = user.photoURL || 'https://www.gravatar.com/avatar?d=mp';
              document.getElementById('firebase-name').textContent = user.displayName || user.email;
              document.getElementById('firebase-login-btn').style.display = 'none';
              document.getElementById('firebase-register-open-btn').style.display = 'none';
            } else {
              document.getElementById('firebase-profile').style.display = 'none';
              document.getElementById('firebase-login-btn').style.display = '';
              document.getElementById('firebase-register-open-btn').style.display = '';
            }
        }

        auth.onAuthStateChanged(updateFirebaseUI);

        document.getElementById('firebase-login-btn').onclick = () => {
          document.getElementById('firebase-login-modal').style.display = 'flex';
        };
        document.getElementById('firebase-email-login-btn').onclick = async () => {
          const email = document.getElementById('login-email').value;
          const password = document.getElementById('login-password').value;
          try {
            await auth.signInWithEmailAndPassword(email, password);
            document.getElementById('firebase-login-modal').style.display = 'none';
          } catch (e) {
            showMessage('Error: ' + e.message);
          }
        };
        // register flow moved to separate modal
        document.getElementById('firebase-register-open-btn').onclick = () => {
          document.getElementById('firebase-register-modal').style.display = 'flex';
        };
        document.getElementById('firebase-close-register-modal').onclick = () => {
          document.getElementById('firebase-register-modal').style.display = 'none';
        };
        document.getElementById('firebase-register-submit-btn').onclick = async () => {
          const email = document.getElementById('register-email').value;
          const password = document.getElementById('register-password').value;
          if (!email || !password) { showMessage('Please enter email and password'); return; }
          try {
            await auth.createUserWithEmailAndPassword(email, password);
            document.getElementById('firebase-register-modal').style.display = 'none';
            showMessage('Account created successfully.');
          } catch (e) {
            showMessage('Error: ' + e.message);
          }
        };
        // Register with Google: allow creating a new account. If account already exists, sign out and show message.
        document.getElementById('firebase-register-google-btn').onclick = async () => {
          const provider = new firebase.auth.GoogleAuthProvider();
          try {
            const result = await auth.signInWithPopup(provider);
            const isNew = result?.additionalUserInfo?.isNewUser;
            if (isNew) {
              document.getElementById('firebase-register-modal').style.display = 'none';
              showMessage('Account created successfully with Google.');
            } else {
              // Account already exists — do not keep the user signed in from the register flow
              await auth.signOut();
              showMessage('That account already exists. Please log in.');
            }
          } catch (e) {
            if (e.code !== 'auth/cancelled-popup-request' && e.code !== 'auth/popup-closed-by-user') {
              showMessage('Error: ' + e.message);
            }
          }
        };

        // Login with Google: only allow sign-in if account already exists. If a new account would be created, remove it and show error.
        document.getElementById('firebase-google-login-btn').onclick = async () => {
          const provider = new firebase.auth.GoogleAuthProvider();
          try {
            const result = await auth.signInWithPopup(provider);
            const isNew = result?.additionalUserInfo?.isNewUser;
            if (isNew) {
              // A new account was created by the popup; remove it because user tried to "login" with a Google account that isn't registered
              try {
                const user = auth.currentUser;
                if (user) {
                  await user.delete();
                }
              } catch (delErr) {
                // If deletion fails, at least sign out
                await auth.signOut();
              }
              showMessage('That Google account is not registered. Please register first.');
            } else {
              document.getElementById('firebase-login-modal').style.display = 'none';
            }
          } catch (e) {
            if (e.code !== 'auth/cancelled-popup-request' && e.code !== 'auth/popup-closed-by-user') {
              showMessage('Error: ' + e.message);
            }
          }
        };

        // login modal controls
        document.getElementById('firebase-close-login-modal').onclick = () => {
          document.getElementById('firebase-login-modal').style.display = 'none';
        };
        // message modal helper
        function showMessage(msg) {
          document.getElementById('firebase-message-content').textContent = msg;
          document.getElementById('firebase-message-modal').style.display = 'flex';
        }
        document.getElementById('firebase-message-close').onclick = () => {
          document.getElementById('firebase-message-modal').style.display = 'none';
        };
        window.firebaseLogout = async () => {
          await auth.signOut();
        };
        window.onload = function() {
          updateFirebaseUI(auth.currentUser);
        };
      </script>
      <div
        id="sidebar"
        class="sidebar flex flex-col w-[22vw] min-w-[60px] max-w-[350px] h-[calc(100vh-57px)] items-start gap-6 px-4 py-8 absolute top-[57px] left-0 bg-[#ffffff0d] border-r-[0.2px] [border-right-style:solid] border-[#ffffffbf] shadow-[17px_8px_39.9px_#00000040] z-20"
      >
        <div id="sidebar-header" class="flex flex-row items-center w-full mt-4 mb-0.5 px-1 gap-2">
          <button
            id="menu-btn"
            class="menu-button relative w-[20.5px] h-[14.5px] bg-[url(https://c.animaapp.com/mjmcwbk4IDVKoU/img/union.svg)] bg-[100%_100%] hover:opacity-80 transition-opacity cursor-pointer border-none p-0 z-30"
            onclick="toggleSidebar()"
            aria-label="Toggle sidebar"
            style="background-color: transparent;"
          ></button>
          <div class="flex-1"></div>
          <button id="plus-btn" class="relative w-6 h-6 ml-2 mr-4 hover:opacity-80 transition-opacity cursor-pointer">
            <img src="https://c.animaapp.com/mjmcwbk4IDVKoU/img/plus-circle.svg" alt="New chat" />
          </button>
        </div>
        <style>
          .sidebar.collapsed #sidebar-header {
            justify-content: center !important;
          }
          .sidebar.collapsed #menu-btn {
            margin-left: 0 !important;
            margin-right: 0 !important;
          }
          .sidebar.collapsed #plus-btn {
            display: none !important;
          }
        </style>
        <div class="sidebar-content flex flex-col w-full gap-6">
          <img
            class="relative w-60 h-px mt-[-0.50px] object-cover"
            src="https://c.animaapp.com/mjmcwbk4IDVKoU/img/vector-1.svg"
          />
          <!-- Botón + eliminado de aquí, ahora está junto al menú hamburguesa -->
          <div class="relative w-full h-[244px]">
            <div class="flex flex-col w-[316px] items-start gap-2 absolute top-8 left-0">
            <div class="flex flex-col items-center justify-center gap-2.5 relative self-stretch w-full flex-[0_0_auto]">
              <div
                class="relative self-stretch mt-[-1.00px] font-body-small-strong font-[number:var(--body-small-strong-font-weight)] text-[#98a6a9] text-[length:var(--body-small-strong-font-size)] tracking-[var(--body-small-strong-letter-spacing)] leading-[var(--body-small-strong-line-height)] [font-style:var(--body-small-strong-font-style)]"
              >
                Chats
              </div>
            </div>
            <div class="flex flex-col items-start gap-2 relative self-stretch w-full flex-[0_0_auto]">
              <div class="flex flex-col items-start gap-2 relative self-stretch w-full flex-[0_0_auto]">
                <button
                  class="chat-item active flex items-center gap-4 px-1.5 py-1 relative self-stretch w-full flex-[0_0_auto] rounded-lg hover:bg-[#ffffff1a] cursor-pointer"
                  onclick="selectChat(this)"
                >
                  <div class="chat-indicator relative h-6 bg-[#ccd0cf]"></div>
                  <div
                    class="chat-text relative flex-1 [font-family:'Inter',Helvetica] text-base tracking-[0] leading-[22.4px] text-left"
                  >
                    Analog Clock React app
                  </div>
                </button>
                <button
                  class="chat-item flex items-center gap-4 px-1.5 py-1 relative self-stretch w-full flex-[0_0_auto] rounded-lg hover:bg-[#ffffff1a] cursor-pointer"
                  onclick="selectChat(this)"
                >
                  <div class="chat-indicator relative h-6 bg-[#ccd0cf]"></div>
                  <div
                    class="chat-text relative flex-1 [font-family:'Inter',Helvetica] text-base tracking-[0] leading-[22.4px] text-left"
                  >
                    Simple Design System
                  </div>
                </button>
                <button
                  class="chat-item flex items-center gap-4 px-1.5 py-1 relative self-stretch w-full flex-[0_0_auto] rounded-lg hover:bg-[#ffffff1a] cursor-pointer"
                  onclick="selectChat(this)"
                >
                  <div class="chat-indicator relative h-6 bg-[#ccd0cf]"></div>
                  <div
                    class="chat-text relative flex-1 [font-family:'Inter',Helvetica] text-base tracking-[0] leading-[22.4px] text-left"
                  >
                    Figma variable planning
                  </div>
                </button>
                <button
                  class="chat-item flex items-center gap-4 px-1.5 py-1 relative self-stretch w-full flex-[0_0_auto] rounded-lg hover:bg-[#ffffff1a] cursor-pointer"
                  onclick="selectChat(this)"
                >
                  <div class="chat-indicator relative h-6 bg-[#ccd0cf]"></div>
                  <div
                    class="chat-text relative flex-1 [font-family:'Inter',Helvetica] text-base tracking-[0] leading-[22.4px] text-left"
                  >
                    OKCLH token algorithm
                  </div>
                </button>
                <button
                  class="chat-item flex items-center gap-4 px-1.5 py-1 relative self-stretch w-full flex-[0_0_auto] rounded-lg hover:bg-[#ffffff1a] cursor-pointer"
                  onclick="selectChat(this)"
                >
                  <div class="chat-indicator relative h-6 bg-[#ccd0cf]"></div>
                  <div
                    class="chat-text relative flex-1 [font-family:'Inter',Helvetica] text-base tracking-[0] leading-[22.4px] text-left"
                  >
                    Component naming advice
                  </div>
                </button>
              </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="main-content-wrapper" class="flex flex-col items-center justify-center h-full transition-all duration-300" style="padding-left: 22vw;">
        <div id="main-title-container" class="flex flex-col items-center justify-center w-full px-2" style="height: 40vh;">
          <p
            class="w-full text-center [-webkit-text-stroke:1px_#98a6a9] [font-family:'Spinnaker',Helvetica] font-normal text-[#9aa8ab] text-2xl md:text-4xl lg:text-5xl tracking-[0] leading-tight whitespace-normal"
          >
            How can I help you today?
          </p>
        </div>
        <div id="chat-input-container" class="flex flex-col items-center justify-center w-full">
          <!-- Chat input box moved here for centering -->
          <div
            class="flex flex-col items-center justify-center gap-4 px-2 py-2 bg-[#ffffff14] rounded-xl overflow-hidden border border-solid border-[#ffffff7d] shadow-md w-[95vw] max-w-xl mx-auto"
            style="height: auto; min-width: 0;"
          >
            <input
              type="text"
              placeholder="What would you like to know?"
              class="relative self-stretch h-[18px] [font-family:'Inter',Helvetica] font-normal text-[#ccd0cf] text-base tracking-[0] leading-6 bg-transparent border-none outline-none placeholder:text-[#ccd0cf]"
            />
            <div class="flex items-end justify-between relative self-stretch w-full flex-[0_0_auto]">
              <div class="flex w-[100px] h-[32px] items-center gap-1 relative">
                <button class="flex w-8 h-8 items-center justify-center p-1 relative rounded-full overflow-hidden hover:bg-[#ffffff1a] transition-colors cursor-pointer">
                  <img class="relative w-4 h-4" src="https://c.animaapp.com/mjmcwbk4IDVKoU/img/image.svg" alt="Upload image" />
                </button>
                <button class="flex w-8 h-8 items-center justify-center p-1 relative rounded-full overflow-hidden hover:bg-[#ffffff1a] transition-colors cursor-pointer">
                  <img class="relative w-4 h-4" src="https://c.animaapp.com/mjmcwbk4IDVKoU/img/paperclip.svg" alt="Attach file" />
                </button>
                <button class="flex w-8 h-8 items-center justify-center p-1 relative rounded-full overflow-hidden hover:bg-[#ffffff1a] transition-colors cursor-pointer">
                  <img class="relative w-4 h-4" src="https://c.animaapp.com/mjmcwbk4IDVKoU/img/mic.svg" alt="Voice input" />
                </button>
              </div>
              <button class="relative flex-[0_0_auto] w-12 h-12 flex items-center justify-center hover:opacity-80 transition-opacity cursor-pointer">
                <img class="w-7 h-7" src="https://c.animaapp.com/mjmcwbk4IDVKoU/img/icon-button.svg" alt="Send message" />
              </button>
            </div>
          </div>
        </div>
      </div>
    <script>
      function selectChat(element) {
        // Remove active class from all chat items
        document.querySelectorAll('.chat-item').forEach(item => {
          item.classList.remove('active');
        });
        // Add active class to clicked item
        element.classList.add('active');
      }

      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content-wrapper');
        const plusBtn = document.getElementById('plus-btn');
        sidebar.classList.toggle('collapsed');
        // Ajustar padding-left del main-content-wrapper según el estado del sidebar
        if (sidebar.classList.contains('collapsed')) {
          mainContent.style.paddingLeft = '60px';
          plusBtn.style.display = 'none';
        } else {
          mainContent.style.paddingLeft = '22vw';
          plusBtn.style.display = '';
        }
      }
      // Ajustar el padding inicial al cargar
      window.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content-wrapper');
        const plusBtn = document.getElementById('plus-btn');
        if (sidebar.classList.contains('collapsed')) {
          mainContent.style.paddingLeft = '60px';
          plusBtn.style.display = 'none';
        } else {
          mainContent.style.paddingLeft = '22vw';
          plusBtn.style.display = '';
        }
      });
    </script>
